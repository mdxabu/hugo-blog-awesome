<head>
    {{- partial "meta/main.html" . }}
    {{- hugo.Generator }}

    {{/* Open Graph tags */}}
    {{ template "_internal/opengraph.html" . }}

    {{/* Twitter Card tags */}}
    {{ template "_internal/twitter_cards.html" . }}

    {{/* Canonical link, RSS */}}

    <link rel="canonical" href="{{ .Permalink }}">
    {{- with .OutputFormats.Get "RSS" }}
    <link href="{{ .RelPermalink }}" rel="alternate" type="application/rss+xml" title="{{ $.Site.Title }}">
    <link href="{{ .RelPermalink }}" rel="feed" type="application/rss+xml" title="{{ $.Site.Title }}">
    {{- end }}

    {{- /* Styles */ -}}

    {{- $style := resources.Get "sass/main.scss" | resources.ExecuteAsTemplate "style.scss" . | toCSS (dict "targetPath" "style.css") | minify | fingerprint }}
    <link href="{{ $style.RelPermalink }}" rel="stylesheet">
    {{- $code_syntax_highlight_css := resources.Get "code-highlight.css" | minify | fingerprint }}
    <link href="{{ $code_syntax_highlight_css.RelPermalink }}" rel="stylesheet">

    {{/* Favicons - SVG working, keep it primary */}}
    {{- $faviconSvg := resources.Get "icons/favicon.svg" }}
    {{- if $faviconSvg }}
    <link rel="icon" type="image/svg+xml" href="{{ $faviconSvg.RelPermalink }}">
    {{- end }}
    
    {{/* Keep essential fallbacks for older browsers */}}
    {{- $faviconIco := resources.Get "icons/favicon.ico" }}
    {{- if $faviconIco }}
    <link rel="icon" href="{{ ($faviconIco | resources.Copy "favicon.ico").RelPermalink }}" type="image/x-icon">
    {{- else }}
    <link rel="icon" href="/favicon.ico" type="image/x-icon">
    {{- end }}
    
    {{/* Apple touch icon for iOS */}}
    {{- $appleIcon := resources.Get "icons/apple-touch-icon.png" }}
    {{- if $appleIcon }}
    <link rel="apple-touch-icon" sizes="180x180" href="{{ $appleIcon.RelPermalink }}">
    {{- end }}

    {{- partial "webmanifest.html" . -}}
    {{- partial "browserconfig.html" . -}}

    <meta name="theme-color" content="{{ .Site.Params.webmanifest.theme_color | default "#434648" }}">

    {{/* Katex support (enabled on specific pages). See 'helpers/katex.html' for more info. */}}

    {{- if or .Params.math .Site.Params.math }}{{ partial "helpers/katex.html" . -}}{{- end -}}

    {{/* Google analytics script. See hugo.toml to enable/disable this. */}}
    {{- if hugo.IsProduction | or (eq site.Params.env "production") }}
    {{ template "_internal/google_analytics.html" . }}
    {{- end -}}

    {{/* Extend head with user supplied partial */}}
    {{ if templates.Exists "partials/custom-head.html" }}
      {{ partial "custom-head.html" . }}
    {{ end }}
</head>
    {{- partial "browserconfig.html" . -}}

    <meta name="theme-color" content="{{ .Site.Params.webmanifest.theme_color | default "#434648" }}">

    {{/* SVG favicon for the modern web */}}
    {{- $faviconSvg := resources.Get "icons/favicon.svg" }}
    {{- if $faviconSvg }}
    <link rel="icon" type="image/svg+xml" href="{{ $faviconSvg.RelPermalink }}">
    {{- else }}
    <!-- Debug: favicon.svg not found in assets/icons/ -->
    {{/* Fallback to ICO if SVG not available */}}
    {{- if $faviconIco }}
    <link rel="icon" href="{{ ($faviconIco | resources.Copy "favicon.svg").RelPermalink }}">
    {{- else }}
    <!-- Ultimate fallback -->
    <link rel="icon" href="/favicon.svg" type="image/x-icon">
    {{- end }}
    {{- end }}

    {{/* Katex support (enabled on specific pages). See 'helpers/katex.html' for more info. */}}

    {{- if or .Params.math .Site.Params.math }}{{ partial "helpers/katex.html" . -}}{{- end -}}

    {{/* Google analytics script. See hugo.toml to enable/disable this. */}}
    {{- if hugo.IsProduction | or (eq site.Params.env "production") }}
    {{ template "_internal/google_analytics.html" . }}
    {{- end -}}

    {{/* Extend head with user supplied partial */}}
    {{ if templates.Exists "partials/custom-head.html" }}
      {{ partial "custom-head.html" . }}
    {{ end }}
</head>
